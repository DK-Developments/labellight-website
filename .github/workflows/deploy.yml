name: Deployment

on:
  # Manual trigger deploys to Development
  workflow_dispatch:
  
  # Pull requests deploy to Test
  pull_request:
    branches:
      - main
      
  # Merges to main deploy to Production
  push:
    branches:
      - main

jobs:
  # Test environment deployment for pull requests
  deploy-test:
    name: Deploy to Test
    if: github.event_name == 'pull_request'
    uses: ./.github/workflows/deploy-environment.yml
    with:
      environment: test
      environment_display_name: Test
    secrets: inherit
    concurrency:
      group: deploy-test-${{ github.head_ref }}
      cancel-in-progress: false

  # Production environment deployment for merges to main
  deploy-prod:
    name: Deploy to Production
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    uses: ./.github/workflows/deploy-environment.yml
    with:
      environment: prod
      environment_display_name: Production
    secrets: inherit
    concurrency:
      group: deploy-prod
      cancel-in-progress: false

  # Development environment deployment for manual triggers
  deploy-dev:
    name: Deploy to Development
    if: github.event_name == 'workflow_dispatch'
    uses: ./.github/workflows/deploy-environment.yml
    with:
      environment: dev
      environment_display_name: Development
    secrets: inherit
    concurrency:
      group: deploy-dev
      cancel-in-progress: false
