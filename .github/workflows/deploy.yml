name: Multi-Account Deployment

on:
  # Pull requests deploy to Development
  pull_request:
    branches:
      - main
      
  # Merges to main deploy to Production
  push:
    branches:
      - main

jobs:
  # Dev environment deployment for pull requests
  deploy-dev:
    name: Deploy to Dev
    if: github.event_name == 'pull_request'
    uses: ./.github/workflows/deploy-environment.yml
    with:
      environment: dev
      environment_display_name: Development
    secrets: inherit
    concurrency:
      group: deploy-dev-${{ github.head_ref }}
      cancel-in-progress: false

  # Production environment deployment for merges to main
  deploy-prod:
    name: Deploy to Production
    if: github.event_name == 'push' && github.ref == 'refs/heads/main'
    uses: ./.github/workflows/deploy-environment.yml
    with:
      environment: prod
      environment_display_name: Production
    secrets: inherit
    concurrency:
      group: deploy-prod
      cancel-in-progress: false
